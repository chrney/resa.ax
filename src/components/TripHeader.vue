<template>
  <div
    class="full-width row wrap justify-start items-start content-start q-col-gutter-md text-black"
  >
    <div class="col-6">
      <strong
      >{{ $moment(plan.startTime).format("LT") }} ~
        {{ $moment(plan.endTime).format("LT") }}</strong
      >
    </div>
    <div class="col-6 text-right text-grey">
      {{ generate_duration(plan) }}
      <!--      <template v-if="plan.duration.hours() > 0">{{ plan.duration.hours() }}</template>-->
      <!--      <template v-if="plan.duration.minutes() > 0">{{ plan.duration.minutes() }}</template>-->

    </div>

    <div class="col-12">
      <template v-for="(leg, idx) in plan.graph" v-bind:key="idx">
        <div
          :style="{ width: leg.percentage + '%' }"
          style="display: inline-block; overflow: hidden; white-space: nowrap"
        >
          <q-tooltip>
            <template v-if="leg.type === 'leg'">
              <template v-if="leg.mode !== 'WALK'">
                {{ $t("header.line") }} <strong>{{ leg.routeShortName }}</strong
              >:
                {{ $t("header.duration_hours", {time: leg.secFormated}) }}
              </template>
              <template v-if="leg.mode === 'WALK'">
                {{ $t("header.walk") }}: {{ leg.secFormated }}
                {{ $t("header.minutes") }}
              </template>
            </template>
            <template v-if="leg.type !== 'leg'">
              {{ $t("header.waiting_time") }} {{ leg.secFormated }}
              {{ $t("header.minutes") }}
            </template>
          </q-tooltip>

          <div
            :class="leg.color"
            class="q-pa-xs"
            style="border-right: 2px solid white"
          >
            <template v-if="leg.type === 'leg'">
              <trip-icon :mode="leg.mode"/>&nbsp;
              <template v-if="leg.mode !== 'WALK'">
                {{ leg.routeShortName }}
              </template>
              <span v-if="leg.mode === 'WALK'">{{
                  leg.secFormated === 0 ? 1 : leg.secFormated
                }}</span>
            </template>
            <template v-if="leg.type === 'pause'">
              <q-icon name="hourglass_top"/>
              {{ leg.secFormated }}
              {{ leg.secFormated > 100 ? $t("header.minutes") : "" }}
            </template>
          </div>
        </div>
      </template>
    </div>

    <div v-if="plan.first_public_leg" class="col-12">
      {{ $t('header.' + plan.first_public_leg.mode.toLowerCase() + '_will_leave') }}
      <strong>{{ $moment(plan.first_public_leg.startTime).format("dddd").toLowerCase() }} kl.
        {{ $moment(plan.first_public_leg.startTime).format("LT") }}</strong> {{ $t('header.from_name') }}
      <strong>{{ plan.first_public_leg.from.name }}</strong>
    </div>
    <!--    <div v-if="plan.days_absolute > 0 || plan.diff.hours() > 0 || plan.diff.days() > 0 || plan.diff.minutes() >0 "-->
    <!--         >-->
    <!--      {{ $t("header.in_the_future") }}-->
    <!--      <strong>-->
    <!--        <template v-if="plan.days_absolute > 0">-->
    <!--          {{ $tc("header.in_x_days_singular_plural", plan.days_absolute) }}&nbsp;-->
    <!--        </template>-->
    <!--        <template v-if="plan.diff.hours() > 0 || plan.days_absolute > 0">-->
    <!--          {{ $t("header.hours", {hours: plan.diff.hours()}) }}&nbsp;-->
    <!--        </template>-->
    <!--        <template-->
    <!--          v-if="-->
    <!--            plan.diff.minutes() > 0 ||-->
    <!--            plan.diff.hours() > 0 ||-->
    <!--            plan.diff.days() > 0-->
    <!--          "-->
    <!--        >{{ plan.diff.minutes() }} {{ $t("header.minutes") }}-->
    <!--        </template>-->
    <!--      </strong>-->

    <!--    </div>-->
  </div>
</template>

<script>
import {defineComponent} from "vue";
import TripIcon from "components/TripIcon";
import {QIcon, QTooltip} from "quasar"
import {useI18n} from "vue-i18n";

export default defineComponent({
  name: "TripHeader",
  props: ["plan"],
  components: {TripIcon, QTooltip, QIcon},
  setup: () => {
    const {t} = useI18n()
    const generate_duration = (item) => {
      let duration_str = [];
      item = item.durationObj
      if (item.hours() > 0) {
        duration_str.push(t("header.hours", item.hours()));
      }

      if (item.minutes() > 0) {
        duration_str.push(t("header.minutes", item.minutes()));
      }

      return duration_str.join(" ");

    }
    return {generate_duration}
  }
});
</script>
